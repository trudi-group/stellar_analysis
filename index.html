<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MobileCoin FBAS Analysis</title>
    <link rel="stylesheet" href="layout.css" type="text/css">
  </head>
  <body>
    <header>
      <a href="https://weizenbaum-institut.de/en/research/rg17/">
        <svg height="50" viewBox="0 0 216 65" role="img">
          <path d="M28.55 9.59l-6.23 17.49L16.7 9.59h-2.14L8.43 27.13 3.15 9.59H1l6.35 19.7h2.02l6.31-17.66 5.69 17.66h1.89l7.4-19.7zm81.89-.29c-7.45 0-7.45 5.6-7.45 7.15v12.84h1.92V16.74c0-1.55 0-5.8 5.53-5.8s5.57 4.26 5.57 5.8v12.55h1.92V16.45c0-1.55-.04-7.15-7.49-7.15zM22.56 43.7c-7.45 0-7.45 5.6-7.45 7.15v12.84h1.92V51.14c0-1.55 0-5.8 5.53-5.8s5.57 4.26 5.57 5.8v12.55h1.92V50.85c.01-1.54-.03-7.15-7.49-7.15zM207.79 9.3c-3.84 0-5.49 1.83-6.19 3.86-.82-2.01-2.6-3.86-6.35-3.86-6.57 0-7.18 4.76-7.23 7.15v12.84h1.92V16.87c0-2.38.52-5.94 5.31-5.94 4.5 0 5.29 3.4 5.29 5.94v12.42h1.92V16.66c.05-2.18.89-5.73 5.33-5.73 4.69 0 5.29 3.36 5.29 5.8v12.55H215V16.62c0-2.21-.65-7.32-7.21-7.32zm-27.76.29v12.55c0 1.88-.28 5.8-5.64 5.8-5.32 0-5.69-3.92-5.69-5.8V9.59h-1.92v12.53c0 1.9.35 7.45 7.62 7.45 6.83 0 7.51-5.02 7.56-7.15V9.59h-1.93zm-71.09 34.4v12.55c0 1.88-.28 5.8-5.64 5.8-5.32 0-5.69-3.92-5.69-5.8V43.99h-1.92v12.53c0 1.9.35 7.45 7.62 7.45 6.83 0 7.51-5.02 7.56-7.15V43.99h-1.93zM55.4 9.59h1.92v19.7H55.4z"></path>
          <ellipse cx="56.37" cy="4.37" rx="1.64" ry="1.68"></ellipse>
          <path d="M7.07 43.99h1.92v19.7H7.07z"></path>
          <ellipse cx="8.03" cy="38.77" rx="1.64" ry="1.68"></ellipse>
          <path d="M71.52 43.99h1.92v19.7h-1.92z"></path>
          <ellipse cx="72.49" cy="38.77" rx="1.64" ry="1.68"></ellipse>
          <path d="M96.89 23.35c-.21 1.06-1.31 6.25-7.7 6.25-5.54 0-8.15-3.9-8.15-10.67 0-5.69 2.84-9.61 8.23-9.61 4.31 0 8.01 2.21 8.01 9.24 0 .42 0 .91-.03 1.29H86.43v-1.71h8.87c0-4.42-1.76-7.19-6.02-7.19-3.81 0-6.31 2.64-6.31 8.09 0 5.67 1.9 8.92 6.3 8.92 3.4 0 5.22-2.09 5.64-4.61h1.98zm-47.76 0c-.21 1.06-1.31 6.25-7.7 6.25-5.54 0-8.15-3.9-8.15-10.67 0-5.69 2.84-9.61 8.23-9.61 4.31 0 8.01 2.21 8.01 9.24 0 .42 0 .91-.03 1.29H38.67v-1.71h8.87c0-4.42-1.76-7.19-6.02-7.19-3.81 0-6.31 2.64-6.31 8.09 0 5.67 1.9 8.92 6.3 8.92 3.4 0 5.22-2.09 5.64-4.61h1.98zm15.58 4.31l12.55-16.44V9.59H62.82v1.63h12.44l-12.5 16.44v1.63h14.77v-1.63zM132 9.3c-2.15 0-3.54.87-3.54.87l.87 1.44s1-.67 2.67-.67c5.93 0 5.5 7.07 5.5 8.51 0 1.8-.33 8.49-5.83 8.49-5.25 0-6.12-4.33-6.12-8.49V1h-1.92v18.95c.02 3.44.4 9.61 8.04 9.61 6.25 0 7.75-5.99 7.75-10.11S138.44 9.3 132 9.3zm19.87-.04c3.42 0 7.37 1.48 7.37 6.07v9.6c0 1.47.53 3.41 3.04 2.45v1.69s-3.41 1.18-4.37-2.41c-.35.54-1.7 2.87-6.55 2.87-4.81 0-7.66-1.9-7.66-6 0 0-.35-7.34 10.93-5.04l-.4 1.6s-8.56-1.71-8.56 3.21c0 4.09 3.17 4.63 5.56 4.63 1.35 0 6.1-.12 6.1-5.17v-7.11c0-1.52-.4-4.73-5.37-4.73-4.96 0-5.08 2.96-5.1 3.25h-1.94c-.02.01.29-4.91 6.95-4.91zm-92.46 49.2V45.63h5.69V44h-5.69v-5.1h-1.92v5.09h-3.52v1.63h3.52v12.84c0 4.15 3.29 6.21 8 5.3v-1.71c0 .01-6.08 1.72-6.08-3.59zm24.86 0V45.63h5.69V44h-5.69v-5.1h-1.92v5.09h-3.52v1.63h3.52v12.84c0 4.15 3.29 6.21 8 5.3v-1.71c0 .01-6.08 1.72-6.08-3.59zm36.74 0V45.63h5.69V44h-5.69v-5.1h-1.92v5.09h-3.52v1.63h3.52v12.84c0 4.15 3.29 6.21 8 5.3v-1.71c0 .01-6.08 1.72-6.08-3.59zM49.96 48.45s-.21-4.8-6.96-4.8c-6.1 0-7.12 3.27-7.12 5.11 0 3.51 3.37 5.06 6.45 5.46 2.82.37 6.12.63 6.12 3.97 0 3.44-3.1 4.15-5.52 4.15-2.85 0-5.62-1.08-5.62-4.31h-2.04c0 .61.19 6.08 7.75 5.96 7.35-.11 7.35-4.25 7.35-5.84 0-2.14-.79-4.99-6.83-5.59-5.7-.56-5.71-3.43-5.71-3.89 0-.65-.04-3.34 5.04-3.34 5.37 0 5.17 3.11 5.17 3.11h1.92z"></path>
        </svg>
      </a>
    </header>

    <h1>MobileCoin FBAS Analysis</h1>

    <p>
      Nodes that are marked as inactive or are obviously misconfigured (induce one-node quorums) are filtered out prior to all analyses on this page.
      For more analysis options check out our <a href="https://github.com/wiberlin/fbas_analyzer">command-line tool</a>.
    </p>

    <div class="control-box">
        Merge nodes by grouping (nodes by the same grouping will count as 1):
        <form name="merge">
          <input name="merge_box" id="no-merge" type="radio" value="none" checked onclick="determine_merge_selection(); maybe_change_analysis()">
          <label for="no-merge">Raw nodes (do not merge)</label>
          <input name="merge_box" id="merge-orgs" type="radio" value="orgs" disabled onclick="determine_merge_selection(); maybe_change_analysis()">
          <label for="merge-orgs" class="disabled">Organizations</label>
          <input name="merge_box" id="merge-isps" type="radio" value="isps" disabled onclick="determine_merge_selection(); maybe_change_analysis()">
          <label for="merge-isps" class="disabled">ISPs</label>
          <input name="merge_box" id="merge-ctry" type="radio" value="ctry" onclick="determine_merge_selection(); maybe_change_analysis()">
          <label for="merge-ctry">Countries</label>
        </form>
    </div>

    <h2>In-depth analysis of one snapshot</h2>

    <p>
      Interactive analyses of the <a href="https://mobilecoin.com/">MobileCoin</a> Federated Byzantine Agreement System (FBAS) using <a href="https://github.com/wiberlin/fbas_analyzer"><code>fbas_analyzer</code></a> compiled to <a href="https://webassembly.org/">WebAssembly</a>.
      The analyses are performed in your browser using <a href="https://github.com/wiberlin/mc-crawler">crawl</a> data downloaded on demand from our <a href="https://172.20.1.162:8000/v1/">database</a>.
      You can also trigger an analysis by clicking on the plot below.
    </p>

    <div class="control-box">
      <input type="date" id="date" name="date" min="2019-07-01">
      <input type="time" id="time" name="time" value="00:00">
      <button id="submit-btn" type="button" onclick="get_and_analyze_stellarbeat_data_via_button()">
        Analyze!
      </button>
      <script>
      var last_merge_state = document.querySelector('input[name=merge_box]:checked').value;
      window.onload = function() {
        var d = new Date();
        var hour = d.getHours(),
              min  = d.getMinutes();
        hour = (hour < 10 ? "0" : "") + hour;
        min = (min < 10 ? "0" : "") + min;
        var dd = String(d.getDate()).padStart(2, '0');
        var mm = String(d.getMonth() + 1).padStart(2, '0');
        var yyyy = d.getFullYear();
        var current_time = hour + ":" + min;
        var today = new Date(yyyy + '-' + mm +'-' + dd);
        document.getElementById('date').valueAsDate = today;
        document.getElementById('time').value = current_time;
        ids_btn = document.getElementById('no-merge');
        ids_btn.checked = true;
        last_merge_state = document.querySelector('input[name=merge_box]:checked').value;
        make_chart_from_csv_url('hourly_chart', 'mobilecoin_hourly.csv');
      }
      </script>
    </div>
    <div id="results-box"></div>

    <h2>Bulk analysis</h2>

    <p>
      The following plot depicts bulk analysis results based on <a href="https://172.20.1.162:8000/v1/">data</a> collected with our <a href="https://github.com/wiberlin/mc-crawler">crawler</a>.
      For each analyzed network snapshot, the plot shows the size of the top tier, the mean, minimum and maximum of all minimal blocking set sizes, and the mean, minimum and maximum of all minimal splitting set sizes.
    </p>


      <div style="height: 500px" width: "300px">
        <canvas id="hourly_chart"></canvas>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
      <script src="https://d3js.org/d3.v5.min.js"></script>
      <script type="text/javascript" src="data_handler.js"></script>
      <script type="text/javascript" src="graph.js"></script>
      <script type="text/javascript" src="util.js"></script>
      <script charset="utf-8">
          var should_merge;
      </script>
      <script charset="utf-8">
          function determine_merge_selection() {
                for (i = 0; i < document.merge.merge_box.length; i++) {
                if (document.merge.merge_box[i].checked) {
                    should_merge = i;
                    make_chart_from_csv_url('hourly_chart', 'mobilecoin_hourly.csv');
                    return i;
                }
             }
          }
          window.determine_merge_selection = determine_merge_selection
      </script>
      <script charset="utf-8">
        const MergeOptions = {
            NONE: 0,
            ORGS: 1,
            ISPS: 2,
            COUNTRY: 3
        };
        var current_nodes;
        var current_orgs;
        var timestamp;
        var stellarbeat_timestamp;
        var inactive_fbas_nodes;
        should_merge = determine_merge_selection();
        make_chart_from_csv_url('hourly_chart', 'mobilecoin_hourly.csv');
      </script>

      <script type="module">
        import init, { analyze_minimal_quorums, analyze_minimal_splitting_sets, analyze_minimal_blocking_sets,
            analyze_top_tier, analyze_symmetric_top_tier,init_panic_hook
        } from './pkg/stellar_analysis.js';
      async function initialise() {
        await init();
		init_panic_hook();
      }
      initialise();
    async function run_mqs(fbas, orgs, should_merge) {
      var results = analyze_minimal_quorums(fbas, orgs, should_merge)
      return results
    }
    window.run_mqs = run_mqs
    async function run_mss(fbas, orgs, should_merge) {
      var results = analyze_minimal_splitting_sets(fbas, orgs, should_merge)
      return results
    }
    window.run_mss = run_mss
    async function run_mbs(fbas, orgs, faulty, should_merge) {
      var results = analyze_minimal_blocking_sets(fbas, orgs, faulty, should_merge)
      return results
    }
    window.run_mbs = run_mbs
    async function run_tt(fbas, orgs, should_merge) {
      var results = analyze_top_tier(fbas, orgs, should_merge)
      return results
    }
    window.run_tt = run_tt
    async function run_symmetric_tt(fbas, orgs, should_merge) {
      var results = analyze_symmetric_top_tier(fbas, orgs, should_merge)
      return results
    }
    window.run_symmetric_tt = run_symmetric_tt
      </script>

      <h2>About</h2>

      <p>
        This page was created by <a href="mailto:charmaine.ndolo@hu-berlin.de">Charmaine Ndolo</a> and <a href="mailto:martin.florian@hu-berlin.de">Martin Florian</a>.
        Both are part of Weizenbaum <a href="https://www.weizenbaum-institut.de/en/research/rg17/">Research Group 17</a>.
        A thorough description of our analysis methodology is available <a href="https://arxiv.org/abs/2002.08101">on arXiv</a>.
      </p>
      <p>
		Here is the link to our <a href="https://github.com/wiberlin/stellar_analysis">Github repository</a> - feel free to check it out.
      </p>

    </body>
</html>
